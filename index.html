<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hog Rider Dash - Waves + Cutscene + Powerups</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    canvas { display: block; margin: 0 auto; background: #87ceeb; }
    #muteBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 8px 14px;
      background: #222;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <button id="muteBtn">Mute</button>
  <canvas id="gameCanvas" width="800" height="400"></canvas>
  <audio id="bgMusic" loop>
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_70dcb4f06a.mp3?filename=epic-battle-music-11277.mp3" type="audio/mpeg">
  </audio>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const bgMusic = document.getElementById("bgMusic");
    const muteBtn = document.getElementById("muteBtn");

    let score = 0;
    let gameOver = false;
    let isJumping = false;
    let jumpY = 0;
    let jumpVelocity = 0;

    let wave = 1;
    let enemies = [];
    let bossActive = false;
    let waveInProgress = false;
    let nextWaveTimeout = null;

    let cutsceneActive = false;
    let cutsceneFrame = 0;

    // Powerup state
    let powerups = [];
    let activePowerup = null;
    let powerupTimer = 0;

    class Enemy {
      constructor(x, y, speed, type) {
        this.x = x;
        this.y = y;
        this.speed = speed;
        this.type = type; // normal or fast
        this.size = type === "fast" ? 25 : 35;
      }
      update() { this.x -= this.speed; }
      draw() {
        ctx.fillStyle = this.type === "fast" ? "red" : "brown";
        ctx.fillRect(this.x, this.y - this.size, this.size, this.size);
      }
    }

    class Boss {
      constructor() {
        this.x = canvas.width;
        this.y = 350;
        this.size = 80;
        this.speed = 3;
        this.timer = 600; // survive duration
      }
      update() { this.x -= this.speed; this.timer--; }
      draw() {
        ctx.fillStyle = "purple";
        ctx.fillRect(this.x, this.y - this.size, this.size, this.size);
      }
    }

    class Powerup {
      constructor(x, y, type) {
        this.x = x;
        this.y = y;
        this.size = 20;
        this.type = type; // shield, doubleJump, boost, coins
      }
      update() { this.x -= 3; }
      draw() {
        ctx.fillStyle = this.type === "shield" ? "blue" : this.type === "doubleJump" ? "orange" : this.type === "boost" ? "yellow" : "gold";
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size/2, 0, Math.PI*2);
        ctx.fill();
      }
    }

    let boss = null;

    function startWave() {
      waveInProgress = true;
      enemies = [];
      if (wave % 5 === 0) {
        bossActive = true;
        boss = new Boss();
      } else {
        let count = 3 + wave * 2;
        for (let i = 0; i < count; i++) {
          let type = Math.random() < 0.3 ? "fast" : "normal";
          enemies.push(new Enemy(canvas.width + i * 150, 350, 2 + wave * 0.3, type));
        }
      }
      // Chance to spawn a powerup
      if (Math.random() < 0.5) {
        let types = ["shield", "doubleJump", "boost", "coins"];
        let type = types[Math.floor(Math.random()*types.length)];
        powerups.push(new Powerup(canvas.width + 400, 340, type));
      }
    }

    function endWave() {
      waveInProgress = false;
      wave++;
      nextWaveTimeout = setTimeout(startWave, 3000);
    }

    function drawPlayer(x = 50, yOffset = jumpY) {
      ctx.fillStyle = activePowerup === "shield" ? "cyan" : "black";
      ctx.fillRect(x, 350 - 40 - yOffset, 40, 40);
    }

    function handleJump() {
      if (isJumping) {
        jumpY += jumpVelocity;
        jumpVelocity -= 0.5;
        if (jumpY <= 0) {
          jumpY = 0;
          isJumping = false;
        }
      }
    }

    function checkCollisions() {
      // Enemies
      if (!bossActive) {
        enemies.forEach(e => {
          if (50 < e.x + e.size && 50 + 40 > e.x && 350 - jumpY > e.y - e.size) {
            if (activePowerup === "shield") {
              activePowerup = null;
            } else {
              gameOver = true;
            }
          }
        });
      } else if (boss) {
        if (50 < boss.x + boss.size && 50 + 40 > boss.x && 350 - jumpY > boss.y - boss.size) {
          if (activePowerup === "shield") {
            activePowerup = null;
          } else {
            gameOver = true;
          }
        }
      }
      // Powerups
      powerups.forEach(p => {
        if (50 < p.x + p.size && 50 + 40 > p.x && 350 - jumpY < p.y && 350 - jumpY > p.y - 40) {
          activePowerup = p.type;
          powerupTimer = 600;
          if (p.type === "coins") score += 200;
          powerups = powerups.filter(pp => pp !== p);
        }
      });
    }

    function playCutscene() {
      ctx.fillStyle = "skyblue";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = "green";
      ctx.fillRect(0,360,canvas.width,40);

      let riderX = cutsceneFrame * 8;
      drawPlayer(riderX, 0);

      ctx.fillStyle = "white";
      ctx.font = "30px Arial";
      ctx.fillText("Victory! The Hog Rider Escapes!", 200, 100);

      cutsceneFrame++;
      if (riderX > canvas.width) {
        ctx.fillStyle = "black";
        ctx.font = "40px Arial";
        ctx.fillText("Thanks for Playing!", 250, 200);
      } else {
        requestAnimationFrame(playCutscene);
      }
    }

    function gameLoop() {
      if (gameOver) {
        ctx.fillStyle = "rgba(0,0,0,0.6)";
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = "white";
        ctx.font = "40px Arial";
        ctx.fillText("Game Over", 300, 200);
        return;
      }

      if (cutsceneActive) {
        playCutscene();
        return;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Ground
      ctx.fillStyle = "green";
      ctx.fillRect(0, 360, canvas.width, 40);

      drawPlayer();
      handleJump();

      if (bossActive && boss) {
        boss.update();
        boss.draw();
        if (boss.timer <= 0) {
          bossActive = false;
          boss = null;
          endWave();
          score += 200;
        }
      } else {
        enemies.forEach(e => e.update());
        enemies.forEach(e => e.draw());
        enemies = enemies.filter(e => e.x + e.size > 0);
        if (enemies.length === 0 && waveInProgress) endWave();
      }

      powerups.forEach(p => { p.update(); p.draw(); });
      powerups = powerups.filter(p => p.x > 0);

      checkCollisions();

      if (activePowerup && powerupTimer > 0) {
        powerupTimer--;
        if (activePowerup === "boost") score += 2; // faster points
        if (activePowerup === "doubleJump") {
          // allow mid-air jump
          document.onkeydown = (e) => {
            if (e.code === "Space") {
              if (!isJumping) {
                isJumping = true;
                jumpVelocity = 10;
              } else if (jumpY > 0) {
                isJumping = true;
                jumpVelocity = 10;
              }
            }
          };
        }
      } else {
        if (activePowerup && powerupTimer <= 0) activePowerup = null;
      }

      score++;
      ctx.fillStyle = "black";
      ctx.font = "20px Arial";
      ctx.fillText("Score: " + score, 20, 30);
      ctx.fillText("Wave: " + wave, 20, 60);
      if (activePowerup) ctx.fillText("Powerup: " + activePowerup, 20, 90);

      if (score >= 2000 && !cutsceneActive) {
        cutsceneActive = true;
        cutsceneFrame = 0;
      } else {
        requestAnimationFrame(gameLoop);
      }
    }

    document.addEventListener("keydown", e => {
      if (e.code === "Space" && !isJumping && !cutsceneActive) {
        isJumping = true;
        jumpVelocity = 10;
      }
    });

    muteBtn.onclick = () => {
      if (bgMusic.paused) {
        bgMusic.play();
        muteBtn.textContent = "Mute";
      } else {
        bgMusic.pause();
        muteBtn.textContent = "Unmute";
      }
    };

    bgMusic.play();
    startWave();
    gameLoop();
  </script>
</body>
</html>
