<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Shadow Eclipse Cutscene</title>
<style>
  body { margin:0; overflow:hidden; background:#000; }
  canvas { display:block; margin:0 auto; background:#111; }
  button { position:fixed; top:10px; right:10px; font-size:16px; z-index:10; }
</style>
</head>
<body>
<button id="startBtn">Start Cutscene</button>
<canvas id="canvas" width="900" height="500"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

const startBtn = document.getElementById('startBtn');
let state = 'menu';
let time = 0;

// Player hero rectangle
const player = { x:400, y:H-100, w:40, h:40 };

// Effects arrays
let meteors = [];
let explosions = [];
let shadowTendrils = [];
let particles = [];
let embers = [];
let flash = 0;
let cameraShake = 0;

// Helpers
function rand(a,b){ return Math.random()*(b-a)+a; }
function createMeteor(){ meteors.push({x:rand(0,W), y:-50, vx:rand(-1,1), vy:rand(5,8), size:10+rand(0,10)}); }
function createExplosion(x,y){ explosions.push({x,y,radius:0,max:30+rand(0,30)}); }
function createTendril(){ shadowTendrils.push({x:rand(0,W), y:H, vy:-rand(1,3), length:rand(50,150)}); }
function createParticle(x,y){ particles.push({x,y,vx:rand(-1,1),vy:rand(-3,-1),size:2+rand(0,2),life:rand(30,60)}); }
function createEmber(x,y){ embers.push({x,y,vx:rand(-0.3,0.3),vy:rand(-1,-0.2),size:2+rand(0,2),life:rand(100,200)}); }

// Update
let lastTime = performance.now();
function update(dt){
  dt/=16.67; time+=dt;

  if(state==='cutscene'){
    // meteors
    if(Math.random()<0.25) createMeteor();
    for(let i=meteors.length-1;i>=0;i--){
      let m = meteors[i];
      m.x+=m.vx*dt; m.y+=m.vy*dt;
      if(m.y>H-50){ createExplosion(m.x,H-50); meteors.splice(i,1); flash=5; cameraShake=10; }
    }

    // explosions
    for(let i=explosions.length-1;i>=0;i--){
      let ex = explosions[i];
      ex.radius+=2*dt;
      if(Math.random()<0.5) createParticle(ex.x+rand(-20,20), ex.y+rand(-20,20));
      if(ex.radius>ex.max) explosions.splice(i,1);
    }

    // shadow tendrils
    if(Math.random()<0.05) createTendril();
    for(let i=shadowTendrils.length-1;i>=0;i--){
      let t = shadowTendrils[i];
      t.y += t.vy*dt;
      if(t.y + t.length < 0) shadowTendrils.splice(i,1);
    }

    // particles
    for(let i=particles.length-1;i>=0;i--){
      let p = particles[i];
      p.x+=p.vx*dt; p.y+=p.vy*dt; p.life-=dt;
      if(p.life<=0) particles.splice(i,1);
    }

    // embers
    if(Math.random()<0.3) createEmber(rand(0,W), H-10);
    for(let i=embers.length-1;i>=0;i--){
      let e = embers[i];
      e.x+=e.vx*dt; e.y+=e.vy*dt; e.life-=dt;
      if(e.life<=0) embers.splice(i,1);
    }

    if(flash>0) flash-=0.3*dt;
    if(cameraShake>0) cameraShake-=0.5*dt;

    // end scene after ~30 seconds
    if(time>30){ state='end'; }
  }
}

// Draw
function draw(){
  ctx.clearRect(0,0,W,H);
  
  // camera shake
  const shakeX = cameraShake*(Math.random()-0.5);
  const shakeY = cameraShake*(Math.random()-0.5);
  ctx.save();
  ctx.translate(shakeX,shakeY);

  // Background eclipse
  let eclipseR = 150+Math.sin(time*0.5)*30;
  ctx.fillStyle = `rgb(${50+flash*40},0,0)`;
  ctx.fillRect(0,0,W,H);
  ctx.fillStyle='black';
  ctx.beginPath();
  ctx.arc(W/2,H/2,eclipseR,0,Math.PI*2);
  ctx.fill();

  // meteors
  ctx.fillStyle='orange';
  for(let m of meteors){ ctx.beginPath(); ctx.arc(m.x,m.y,m.size,0,Math.PI*2); ctx.fill(); }

  // explosions
  for(let ex of explosions){
    let grad = ctx.createRadialGradient(ex.x,ex.y,0,ex.x,ex.y,ex.radius);
    grad.addColorStop(0,'yellow'); grad.addColorStop(0.5,'orange'); grad.addColorStop(1,'rgba(255,0,0,0)');
    ctx.fillStyle=grad;
    ctx.beginPath(); ctx.arc(ex.x,ex.y,ex.radius,0,Math.PI*2); ctx.fill();
  }

  // shadow tendrils
  ctx.strokeStyle='purple'; ctx.lineWidth=4;
  for(let t of shadowTendrils){ ctx.beginPath(); ctx.moveTo(t.x,t.y); ctx.lineTo(t.x,t.y+t.length); ctx.stroke(); }

  // particles
  ctx.fillStyle='white';
  for(let p of particles){ ctx.globalAlpha = p.life/60; ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill(); }
  ctx.globalAlpha=1;

  // embers
  ctx.fillStyle='orange';
  for(let e of embers){ ctx.globalAlpha = e.life/200; ctx.beginPath(); ctx.arc(e.x,e.y,e.size,0,Math.PI*2); ctx.fill(); }
  ctx.globalAlpha=1;

  // player rectangle hero
  if(state!=='end'){ ctx.fillStyle='white'; ctx.fillRect(player.x,player.y,player.w,player.h); }

  ctx.restore();

  // end screen
  if(state==='end'){
    ctx.fillStyle='rgba(0,0,0,0.7)'; ctx.fillRect(0,0,W,H);
    ctx.fillStyle='white'; ctx.font='50px sans-serif';
    ctx.fillText('THE SHADOW CONSUMES ALL', W/2-300,H/2);
    ctx.font='28px sans-serif';
    ctx.fillText('Thanks for playing!', W/2-120,H/2+50);
  }
}

// Loop
function loop(now){
  const dt = now-lastTime; lastTime=now;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// Start cutscene
startBtn.addEventListener('click', ()=>{
  state='cutscene';
  time=0;
  meteors=[]; explosions=[]; shadowTendrils=[]; particles=[]; embers=[];
  flash=0; cameraShake=0;
});
</script>
</body>
</html>

